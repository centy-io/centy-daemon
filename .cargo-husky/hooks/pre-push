#!/bin/sh
set -e

echo "Pre-push checks starting..."

echo "[1/6] Checking formatting..."
cargo fmt --all -- --check

echo "[2/6] Running Clippy..."
cargo clippy --all-targets -- -D warnings

echo "[3/6] Type checking..."
cargo check --all-targets

echo "[4/6] Building project..."
cargo build --all-targets

echo "[5/6] Running tests..."
CENTY_HOME="$(mktemp -d)" cargo test --all-targets

echo "[6/6] Running dylint lints..."
cargo dylint --all

echo "[7/7] Running e2e tests..."
cd e2e && pnpm test && cd ..

echo "Pre-push checks passed!"
