---
displayNumber: 146
status: in-progress
priority: 1
createdAt: 2026-02-06T00:28:21.584226+00:00
updatedAt: 2026-02-06T14:45:44.373547+00:00
---

# safety: use proper shell escaping in terminal and editor command construction

Terminal and editor integration code constructs shell commands via string formatting and manual escaping, which is incomplete and could cause panics or unexpected behavior when paths contain special characters.

Issues in src/workspace/terminal.rs:

* Line 74: Manual escaping only handles backslash and double-quote for AppleScript, but does not escape dollar signs, backticks, or single quotes — a workspace path like ~/my$project would be interpolated by the shell
* Line 71: cd ‘{}’ uses single-quote wrapping but the path itself is not escaped for single quotes (a path containing a single quote would break the command)
* Lines 98, 114: format!(“{command}; exec bash”) passes user-influenced command strings directly to bash -c
* Line 127: Same pattern in xterm fallback with cd ‘{}’
* Line 157: Windows cd /d “{}” — path with double-quote characters would break

Issues in src/workspace/editor_config.rs:

* Line 183: editor.open_dir.replace(“{dir}”, &dir_str) — workspace path injected into shell command template without escaping
* Line 206: setup_cmd.replace(“{dir}”, &dir_str) — same issue in setup commands
* Lines 155-157, 209-211: These strings are then passed to sh -c / cmd /C

The shell-escape crate is already a dependency but is not used in these code paths. A workspace path containing shell metacharacters could cause the shell command to fail/panic unexpectedly or execute unintended commands.

Proposal:

1. Use the existing shell-escape crate consistently for all path arguments passed to shell commands
1. Where possible, use Command::new().arg() instead of sh -c to avoid shell interpretation entirely
1. For AppleScript, properly escape for the AppleScript string context
1. Consider adding a helper function that wraps shell escaping to enforce consistent usage
