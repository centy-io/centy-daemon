---
displayNumber: 150
status: open
priority: 2
createdAt: 2026-02-06T00:43:08.366699+00:00
updatedAt: 2026-02-06T00:43:08.366699+00:00
---

# Add e2e tests for lifecycle hooks

## Context

The lifecycle hooks system (added in #32) allows executing bash scripts before and after item operations via configurable patterns (phase:item_type:operation). While there are unit/integration tests in tests/hooks_test.rs, there are no e2e tests that validate hooks through the gRPC API end-to-end.

## Goal

Add comprehensive e2e tests in e2e/hooks.e2e.spec.ts that validate hooks work correctly through the full gRPC flow â€” from configuration to execution.

## Test Coverage

### Hook Configuration via gRPC

* Add/update/remove hooks via UpdateConfig
* Verify hooks persist in config.json
* Verify GetConfig returns configured hooks

### Pre-Hook Blocking

* Pre-hook with exit 1 blocks the operation and returns error
* Pre-hook with exit 0 allows the operation to proceed
* Verify the item is NOT created when pre-hook blocks
* Error response includes hook pattern info

### Post-Hook Execution

* Sync post-hook runs after successful operation (verify via side-effect, e.g. file creation)
* Post-hook receives success: true on success, success: false on failure
* Async (is_async: true) post-hook runs in background without blocking response

### Hook Pattern Matching

* Wildcard patterns (*:*:delete, pre:\*:create, *:issue:*) match correctly
* Multiple hooks execute in specificity order (most-specific first)
* Disabled hooks (enabled: false) are skipped

### Hook Context Data

* Environment variables (CENTY_PHASE, CENTY_ITEM_TYPE, CENTY_OPERATION, CENTY_PROJECT_PATH, CENTY_ITEM_ID) are set correctly
* Stdin JSON contains phase, item_type, operation, project_path, item_id, request_data, success
* item_id is present for post-hooks on create operations

### Hook Timeout

* Hook with short timeout (1s) that runs a long command gets killed
* Timeout error is returned appropriately

### Cross-Item-Type Hooks

* Hooks fire correctly for issues, docs, PRs, users, links, and assets

### Dynamic Config Updates

* Adding hooks via UpdateConfig makes them active for subsequent operations
* Disabling/removing hooks takes effect immediately

## Implementation Notes

* Follow existing e2e patterns using createTempProject() fixture and Vitest
* Hooks write side-effect files to verify execution
* Use writeProjectFile() to set up hook scripts before operations
* Use readProjectFile() / projectFileExists() to verify hook side-effects
* For async post-hooks, use polling with small delay to verify eventual execution
