---
displayNumber: 152
status: open
priority: 2
createdAt: 2026-02-06T00:49:47.949392+00:00
updatedAt: 2026-02-06T00:49:47.949392+00:00
---

# Unified Read gRPC RPC

Add a unified `Read` RPC that replaces the individual Get\* RPCs for issue, doc, and PR entities. Reuses existing `EntityType` enum. Empty `project_path` triggers cross-project search. Response uses `oneof` for polymorphic entity data. Old RPCs stay but are marked deprecated. Network-layer only initially — handler dispatches to existing internal functions.

## 1. Proto Message Definitions

### Proto Changes (`proto/centy.proto`)

#### New RPC (add to service definition after `GetEntityActions`)

````proto
// Unified Read RPC — replaces individual Get* RPCs for issue/doc/pr.
// project_path non-empty -> single-project read (1 result).
// project_path empty -> cross-project search (N results).
// Replaces: GetIssue, GetIssueByDisplayNumber, GetIssuesByUuid,
//           GetDoc, GetDocsBySlug, GetPr, GetPrByDisplayNumber, GetPrsByUuid
rpc Read(ReadRequest) returns (ReadResponse);
````

#### New Messages (add after `GetEntityActionsResponse`)

````proto
message ReadRequest {
  EntityType entity_type = 1;         // ENTITY_TYPE_ISSUE, ENTITY_TYPE_PR, or ENTITY_TYPE_DOC
  string project_path = 2;            // If empty -> cross-project search

  string id = 3;                      // UUID for issue/pr
  optional uint32 display_number = 4; // For issue/pr by display number (single-project only)
  string slug = 5;                    // For doc by slug
}

message ReadResult {
  oneof entity {
    Issue issue = 1;
    Doc doc = 2;
    PullRequest pr = 3;
  }
  // Fields 4-9 reserved for future entity types
  string project_path = 10;
  string project_name = 11;
  string display_path = 12;
}

message ReadResponse {
  bool success = 1;
  string error = 2;
  repeated ReadResult results = 3;
  int32 total_count = 4;
  repeated string errors = 5;        // Non-fatal errors from cross-project search
}
````

## 2. Handler Dispatch Logic

### Server Handler (`src/server/mod.rs`)

#### Imports

Add `ReadRequest, ReadResponse, ReadResult` to the `use proto::{...}` block, plus:

````rust
use proto::read_result::Entity as ReadResultEntity;
````

#### Private Helpers (on `impl CentyDaemonService`)

**`read_single_project(&self, req: &ReadRequest)`** — dispatch:

* **Issue**: `display_number.is_some()` -> `get_issue_by_display_number`; else -> `get_issue(&id)`. Needs `priority_levels` from `read_config`.
* **Doc**: `get_doc(&slug)`. No priority_levels needed.
* **PR**: same as issue pattern with `get_pr` / `get_pr_by_display_number`. Needs `priority_levels`.
* **Unspecified**: return error.
* Returns 1 `ReadResult` with empty project context fields.

**`read_cross_project(&self, req: &ReadRequest)`** — dispatch:

* Call `list_projects(ListProjectsOptions::default())` first.
* **Issue**: `get_issues_by_uuid(&id, &projects)` -> map to `ReadResult` with `ReadResultEntity::Issue(...)`, fill project context via `format_display_path`.
* **Doc**: `get_docs_by_slug(&slug, &projects)` -> map to `ReadResult` with `ReadResultEntity::Doc(...)`.
* **PR**: `get_prs_by_uuid(&id, &projects)` -> map to `ReadResult` with `ReadResultEntity::Pr(...)`.
* Uses `priority_levels = 3` for issue/pr (same as existing cross-project handlers).
* Populates `ReadResponse.errors` from `result.errors`.

#### Trait Handler

Place near `get_entity_actions`. Thin dispatcher:

````rust
#[instrument(name = "grpc.read", skip(self, request), fields(request_id = %generate_request_id()))]
async fn read(&self, request: Request<ReadRequest>) -> Result<Response<ReadResponse>, Status> {
    let _timer = OperationTimer::new("read");
    let req = request.into_inner();
    if req.project_path.is_empty() {
        self.read_cross_project(&req).await
    } else {
        self.read_single_project(&req).await
    }
}
````

## 3. Identifier Resolution

### Identifier Resolution Precedence

|entity_type|Single-project|Cross-project|
|-----------|--------------|-------------|
|ISSUE|`display_number` > `id`|`id` (UUID)|
|PR|`display_number` > `id`|`id` (UUID)|
|DOC|`slug`|`slug`|

## 4. Deprecation Approach

Add `// Deprecated: Use Read RPC instead.` comment above each of these 8 RPCs:

* `GetIssue`, `GetIssueByDisplayNumber`, `GetIssuesByUuid`
* `GetDoc`, `GetDocsBySlug`
* `GetPr`, `GetPrByDisplayNumber`, `GetPrsByUuid`

Old RPCs stay as-is — no thin-wrapper conversion. They remain fully functional until clients migrate.

## 5. Existing Functions to Reuse

|Function|Used for|
|--------|--------|
|`get_issue(path, &id)`|Single-project issue by UUID|
|`get_issue_by_display_number(path, n)`|Single-project issue by number|
|`get_issues_by_uuid(&uuid, &projects)`|Cross-project issue search|
|`get_doc(path, &slug)`|Single-project doc|
|`get_docs_by_slug(&slug, &projects)`|Cross-project doc search|
|`get_pr(path, &id)`|Single-project PR by UUID|
|`get_pr_by_display_number(path, n)`|Single-project PR by number|
|`get_prs_by_uuid(&uuid, &projects)`|Cross-project PR search|
|`issue_to_proto`, `doc_to_proto`, `pr_to_proto`|Proto conversion|
|`format_display_path`, `read_config`, `list_projects`, `track_project_async`|Shared utilities|

## 6. Verification Steps

1. `cargo build` — verify proto compilation (first `oneof` in project)
1. `cargo test` — verify no regressions
1. Manual smoke test with grpcurl against running daemon
