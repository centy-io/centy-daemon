---
displayNumber: 194
status: in-progress
priority: 2
createdAt: 2026-02-15T20:55:14.357387+00:00
updatedAt: 2026-02-15T20:58:04.036164+00:00
---

# Unify delete logic for all item types (static and custom)

Delete, soft-delete, and restore operations are currently implemented three separate times — once for the generic/custom item layer, once for issues, and once for docs. This duplication leads to inconsistent behavior and maintenance burden. We should consolidate all delete logic into the generic layer so every item type (built-in or custom) goes through the same path.

## Current state

There are 3 independent implementations of each delete operation:

* **Generic** (`item/generic/storage.rs`): `generic_delete()`, `generic_soft_delete()`, `generic_restore()`
* **Issues** (`item/entities/issue/crud.rs`): `delete_issue()`, `soft_delete_issue()`, `restore_issue()`
* **Docs** (`item/entities/doc/crud.rs`): `delete_doc()`, `soft_delete_doc()`, `restore_doc()`

There are also 9 gRPC handlers (3 per type) instead of 3 unified ones.

### Inconsistencies

* **Force parameter**: Generic supports `force: bool` for hard vs soft delete; Issues and Docs always hard-delete with no force option
* **Asset cleanup**: Generic checks `config.features.assets`; Issues always clean up assets; Docs never do
* **Handler routing**: `DeleteItem` calls generic (correct), but `DeleteIssue`/`DeleteDoc` call their own specific functions, bypassing the generic layer
* **Metadata duplication**: `deleted_at`/`created_at`/`updated_at` are duplicated across `IssueMetadata`, `DocMetadata`, and `GenericFrontmatter`

## Goal

1. Issue and doc specific delete handlers route through the generic layer
1. The `force` parameter is available for all types
1. Asset cleanup is driven by `config.features.assets` uniformly
1. The 6 type-specific CRUD functions (`delete_issue`, `soft_delete_issue`, `restore_issue`, `delete_doc`, `soft_delete_doc`, `restore_doc`) are removed or reduced to thin wrappers around generic
1. The 6 type-specific gRPC handlers (`DeleteIssue`, `SoftDeleteIssue`, `RestoreIssue`, `DeleteDoc`, `SoftDeleteDoc`, `RestoreDoc`) redirect to the unified `DeleteItem`/`SoftDeleteItem`/`RestoreItem`

## Files involved

* `src/item/generic/storage.rs` — generic delete/soft-delete/restore (the target unified layer)
* `src/item/entities/issue/crud.rs` — issue-specific delete functions to remove
* `src/item/entities/doc/crud.rs` — doc-specific delete functions to remove
* `src/server/handlers/item_delete.rs` — unified DeleteItem handler
* `src/server/handlers/item_soft_delete.rs` — unified SoftDeleteItem handler
* `src/server/handlers/item_restore.rs` — unified RestoreItem handler
* `src/server/handlers/issue_delete.rs` — to redirect to unified handler
* `src/server/handlers/issue_soft_delete.rs` — to redirect to unified handler
* `src/server/handlers/issue_restore.rs` — to redirect to unified handler
* `src/server/handlers/doc_delete.rs` — to redirect to unified handler
* `src/server/handlers/doc_soft_delete.rs` — to redirect to unified handler
* `src/server/handlers/doc_restore.rs` — to redirect to unified handler
* `src/server/handlers/item_type_resolve.rs` — config resolution for type routing
