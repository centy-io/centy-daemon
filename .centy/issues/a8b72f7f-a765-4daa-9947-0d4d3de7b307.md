---
displayNumber: 164
status: open
priority: 1
createdAt: 2026-02-15T16:14:34.962843+00:00
updatedAt: 2026-02-15T16:23:01.672246+00:00
---

# Make the daemon item-agnostic (tracking issue)

Master tracking issue for removing hardcoded item types (Issue, PR, Doc) and replacing them with a fully configurable, generic item system. This is the top priority initiative for centy-daemon.

## Problem

The daemon currently hardcodes three item types: Issue, PullRequest, and Doc. This manifests as:

* **src/item/mod.rs** — ItemType enum with only 3 hardcoded variants
* **src/item/entities/** — Separate modules for issue/, pr/, doc/ with duplicated logic
* **src/server/handlers/** — 20+ handler files (issue_create.rs, doc_read.rs, pr_update.rs, etc.)
* **src/server/trait_impl.rs** — 37+ individual gRPC RPC implementations
* **src/server/convert_entity.rs** — Type-specific proto conversions
* **Proto definitions** — Separate request/response message types per entity
* **src/common/metadata.rs** — CommonMetadata shared by Issue/PR but NOT Doc
* **src/workspace/editor.rs** — Hardcoded EditorType enum (VS Code + Terminal only)

Users cannot define their own item types (epics, tasks, features, bugs, stories). Every new item type requires code changes across the entire stack.

## Design Decision: .centy/<item>/config.yaml

Each item type is defined by a config.yaml file inside its own folder under .centy/:

```
.centy/
  issues/
    config.yaml      # schema + config for the "issue" item type
    0001.md
  docs/
    config.yaml      # schema + config for the "doc" item type
    my-doc.md
  features/
    config.yaml      # custom "feature" item type
  bugs/
    config.yaml      # custom "bug" item type
```

Key principles:
- Item types are defined by the presence of a config.yaml in a .centy/<type>/ directory
- The daemon discovers types at startup by scanning .centy/*/config.yaml
- No central registry file — the folder structure IS the registry
- Built-in types (issue, doc) are created by `centy init` with default config.yaml files
- Built-in types use the exact same system as custom types — no special code paths
- Migration: `centy update` adds config.yaml to existing issue/doc folders

## Goal

Replace the hardcoded type system with a config-driven, runtime-defined item type registry. Users define item types via .centy/<type>/config.yaml with feature flags controlling capabilities per type (displayNumber, status, priority, softDelete, assets, orgSync, move, duplicate).

## Phased Plan

### Phase 1: Foundation (sequential, blocks everything)

#### 1a. Common trait interfaces (#105)

Implement the trait stubs that already exist in src/item/core/metadata.rs (ItemMetadata, DisplayNumbered, Statusable, Prioritized) on the actual entities. Wire up Item and ItemCrud traits from src/item/core/crud.rs. Consolidate deleted_at, fix OrgSyncable (only Issues implement it, Docs do manual sync).

#### 1b. Config-driven item type registry (#135, #130, GH#47)

Replace hardcoded ItemType enum with dynamic config-defined types. The daemon scans .centy/*/config.yaml to discover item types. `centy init` creates .centy/issues/config.yaml and .centy/docs/config.yaml with defaults. Built-in types (issue, doc) are just pre-created instances of this same system.

### Phase 2: Core systems (4 parallel streams after Phase 1)

| Stream | Scope | Related Issues |
|--------|-------|----------------|
| **A** | Generic storage + unified gRPC API (collapse 37+ RPCs into ~7 generic ones) | GH#47 |
| **B** | Configurable editor support (replace EditorType enum) | #138 |
| **C** | Entity-agnostic conversations | #33 |
| **D** | Validate hooks work with custom types + e2e tests | #137, #150 |

### Phase 3: Extensions (2 parallel streams after Phase 2)

| Stream | Scope | Related Issues |
|--------|-------|----------------|
| **E** | Custom templates per item type | #139 |
| **F** | Custom commands per item type | #140 |

## All Related Issues

| # | Title | Phase |
|---|-------|-------|
| 105 | Add common trait interface for Issues, PRs, and Docs | 1a |
| 135 | Custom item types | 1b |
| 130 | Support custom item types and templates | 1b |
| GH#47 | RFC: Enable Custom Entity Types | 1b |
| 162 | Remove PR entity type | 1b |
| 138 | Configurable editor support | 2-B |
| 33 | Issue Conversation Feature (entity-agnostic) | 2-C |
| 137 | Custom lifecycle hooks | 2-D |
| 150 | Add e2e tests for lifecycle hooks | 2-D |
| 139 | Custom templates per item type | 3-E |
| 140 | Custom commands per item type | 3-F |
| 98 | Open in source control (SCM agnostic) | related |

## Dependency Graph

```
Phase 1a (#105: traits) + #162 (remove PR)
    |
    v
Phase 1b (#135: config.yaml registry)
    |
    +---> Stream A: Generic storage + unified gRPC
    +---> Stream B: Editor config (#138)
    +---> Stream C: Entity-agnostic conversations (#33)
    +---> Stream D: Validate hooks (#137, #150)
              |
              +---> Stream E: Custom templates (#139)
              +---> Stream F: Custom commands (#140)
```
