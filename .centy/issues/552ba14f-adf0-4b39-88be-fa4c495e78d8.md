---
displayNumber: 163
status: open
priority: 2
createdAt: 2026-02-10T23:43:51.467590+00:00
updatedAt: 2026-02-10T23:43:51.467590+00:00
---

# Extract search logic from the daemon into an external service

Remove all search logic (~1,870 lines) from the daemon and provide search capabilities through an external service instead. The daemon should remain a lean file-based data engine focused on CRUD operations, not query execution.

## What to remove

### Source code

* `src/search/` - entire search module (grammar, parser, AST, evaluator, executor, errors)
* `src/search/grammar.pest` - PEG grammar definition
* `src/server/handlers/search.rs` - gRPC search handler
* Search-related exports from `src/lib.rs` (`advanced_search`, `parse_query`, `format_query`, `SearchError`, `SearchOptions`, `SearchResult`, `SearchResultIssue`, `SortField`, `SortOptions`)
* `pest` and `pest_derive` dependencies from `Cargo.toml`

### Proto definitions

* `AdvancedSearch` RPC from `proto/centy/v1/centy.proto`
* `AdvancedSearchRequest`, `AdvancedSearchResponse`, `SearchResultIssue` messages

### Tests

* Any search-related unit and e2e tests

## Approaches for external search

### Option A: Client-side search

The daemon already exposes `ListIssues` (single-project) and `ListAllIssues` (multi-project). Clients could fetch all items and perform filtering, sorting, and querying in their own layer.

**Pros:**

* Simplest to implement - zero new infrastructure
* No daemon changes needed beyond removing search code
* Each client can optimize for its own UX (fuzzy search, instant results, etc.)

**Cons:**

* Duplicated search logic across clients (CLI, web, IDE extensions)
* Performance degrades with large datasets (all items transferred over the wire)
* No shared query language across clients

### Option B: Sidecar search service

A separate process (could be a lightweight Rust binary, or an off-the-shelf engine like MeiliSearch/Typesense/Tantivy) that watches `.centy/` directories and maintains a search index. The daemon notifies it of changes via its existing hooks system.

**Pros:**

* Purpose-built search with proper indexing (inverted index, fuzzy matching, typo tolerance)
* Decoupled from daemon lifecycle - can be upgraded independently
* Could leverage battle-tested engines (MeiliSearch, Typesense)
* Single search endpoint for all clients

**Cons:**

* Additional process to manage and deploy
* Index synchronization complexity (file changes, multi-project)
* Heavier infrastructure requirement for users

### Option C: Plugin / extension architecture

The daemon defines a search interface (gRPC service definition or trait), and search providers are registered as external processes. The daemon proxies search requests to the configured provider, or returns an error if none is configured.

**Pros:**

* Users choose their own search backend
* Daemon stays lean but still provides a unified search API
* Extensible - custom search providers for specialized use cases

**Cons:**

* More complex configuration and setup
* Plugin protocol needs careful design
* Still couples search API to daemon’s gRPC surface

### Option D: Standalone search CLI / library crate

Extract the search module into a separate Rust crate (`centy-search`) that reads `.centy/` files directly from disk. Can be used as a CLI tool or linked as a library by other tools.

**Pros:**

* Reusable across CLI, IDE extensions, CI pipelines
* No network overhead - reads files directly
* Can be published and versioned independently
* Preserves the existing query language investment

**Cons:**

* Each consumer needs filesystem access to `.centy/` directories
* No centralized index - re-parses files on every query
* Doesn’t work for remote/web clients without a wrapper service

## Open questions

* Which clients currently use `AdvancedSearch`? What’s the migration path?
* Should the daemon expose a change-feed or event stream to help external services stay in sync?
* Is the existing PEG query language worth preserving in some form, or should we adopt an existing standard (e.g., Lucene syntax)?
* Should sorting remain in the daemon (on `ListIssues`) or also move externally?
