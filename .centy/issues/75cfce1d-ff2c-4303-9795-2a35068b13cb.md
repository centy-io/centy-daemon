---
displayNumber: 34
status: open
priority: 3
createdAt: 2025-12-10T16:10:44.796095+00:00
updatedAt: 2025-12-10T16:10:44.796095+00:00
---

# Issue Assignees + Project Users System

We want to have the option to assign multiple people per issue. Users should be able to add and remove assignments.

---

## Requirements

### Project Users

* Store team members at the project level in `.centy/users.json`
* User fields: id (slug), name, email, gitUsername
* Auto-detect users from git history with `centy sync users`

### Issue Assignees

* Add native `assignees` field to issue metadata (array of user IDs)
* Support multiple assignees per issue
* Validate assignee IDs against users list

### CLI Commands

**User management:**

* `centy create user -i <id> -n <name> [-e email] [-g git-username]`
* `centy list users [--json]`
* `centy update user <id> [--name] [--email] [--git-username]`
* `centy delete user <id> [-f]`
* `centy sync users [--dry-run]` - auto-populate from git

**Assignee management:**

* `centy assign issue <id> <user1> [user2...]` - dedicated command
* `centy unassign issue <id> <user1> [user2...]` - dedicated command
* `centy update issue <id> --assign <user> --unassign <user>` - flags on update

---

## Implementation Plan

### Phase 1: Core User System (Daemon)

New files in `centy-daemon/src/user/`:

|File|Purpose|
|----|-------|
|`mod.rs`|User struct, module exports|
|`storage.rs`|Read/write `.centy/users.json`|
|`crud.rs`|Create, get, list, update, delete operations|
|`sync.rs`|Git history sync logic|

**User struct:**

````rust
pub struct User {
    pub id: String,           // Unique slug (e.g., "john-doe")
    pub name: String,         // Display name
    pub email: Option<String>,
    pub git_username: Option<String>,
    pub created_at: String,
    pub updated_at: String,
}
````

### Phase 2: Proto Definitions

Modify `centy-daemon/proto/centy.proto`:

Add messages:

* `User`, `CreateUserRequest/Response`, `GetUserRequest`
* `ListUsersRequest/Response`, `UpdateUserRequest/Response`
* `DeleteUserRequest/Response`, `SyncUsersRequest/Response`
* `AssignIssueRequest/Response`, `UnassignIssueRequest/Response`

Add RPCs to `CentyDaemon` service:

* `CreateUser`, `GetUser`, `ListUsers`, `UpdateUser`, `DeleteUser`, `SyncUsers`
* `AssignIssue`, `UnassignIssue`

Add to `IssueMetadata`:

````protobuf
repeated string assignees = 10;
````

### Phase 3: Daemon Server Implementation

Modify `centy-daemon/src/server/mod.rs`:

* User CRUD handlers
* Git sync handler
* Assign/unassign handlers

### Phase 4: Issue Metadata Extension

Modify `centy-daemon/src/issue/metadata.rs`:

````rust
#[serde(default, skip_serializing_if = "Vec::is_empty")]
pub assignees: Vec<String>,
````

Modify `centy-daemon/src/issue/crud.rs`:

* `assign_issue(project_path, issue_id, user_ids)` - validate users exist, merge assignees
* `unassign_issue(project_path, issue_id, user_ids)` - remove assignees

### Phase 5: CLI Types and Client Functions

Modify `centy-cli/src/daemon/types.ts` - add TypeScript types

New daemon client functions:

* `daemon-create-user.ts`
* `daemon-get-user.ts`
* `daemon-list-users.ts`
* `daemon-update-user.ts`
* `daemon-delete-user.ts`
* `daemon-sync-users.ts`
* `daemon-assign-issue.ts`
* `daemon-unassign-issue.ts`

### Phase 6: CLI Commands

New command files in `centy-cli/src/commands/`:

* `create/user.ts`
* `list/users.ts`
* `update/user.ts`
* `delete/user.ts`
* `sync/users.ts`
* `assign/issue.ts`
* `unassign/issue.ts`

Modify `update/issue.ts` - add `--assign` and `--unassign` flags

---

## Storage Format

**`.centy/users.json`:**

````json
{
  "users": [
    {
      "id": "john-doe",
      "name": "John Doe",
      "email": "john@example.com",
      "gitUsername": "johndoe",
      "createdAt": "2025-01-01T00:00:00Z",
      "updatedAt": "2025-01-01T00:00:00Z"
    }
  ]
}
````

**`.centy/issues/{uuid}/metadata.json`:**

````json
{
  "displayNumber": 1,
  "status": "open",
  "priority": 2,
  "assignees": ["john-doe", "jane-smith"],
  ...
}
````

---

## Git Sync Logic

`centy sync users`:

1. Run `git log --format='%an|%ae' | sort -u`
1. Parse name/email pairs
1. Generate slug from name (lowercase, hyphenated)
1. Skip if email already exists in users
1. Create new users (or show what would be added with `--dry-run`)

---

## Validation Rules

* User ID: lowercase alphanumeric + hyphens, unique
* Assignees: must exist in users.json
* Email: basic format validation (if provided)

---

## Critical Files Summary

**Daemon (Rust):**

* `centy-daemon/proto/centy.proto` - API definitions
* `centy-daemon/src/user/` (new module)
* `centy-daemon/src/issue/metadata.rs` - add assignees field
* `centy-daemon/src/issue/crud.rs` - assign/unassign functions
* `centy-daemon/src/server/mod.rs` - RPC implementations
* `centy-daemon/src/lib.rs` - export user module

**CLI (TypeScript):**

* `centy-cli/src/daemon/types.ts` - type definitions
* `centy-cli/src/daemon/daemon-*.ts` - client functions (8 new files)
* `centy-cli/src/commands/` - 7 new command files
* `centy-cli/src/commands/update/issue.ts` - add assign/unassign flags
