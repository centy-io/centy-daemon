---
displayNumber: 108
status: in-progress
priority: 1
createdAt: 2026-01-09T18:17:18.141244+00:00
updatedAt: 2026-01-14T23:11:06.138920+00:00
---

# Achieve 100% test coverage

## Objective

Achieve 100% test coverage for the centy-daemon codebase. Currently configured with a 90% threshold in `.tarpaulin.toml`.

## Current State

### Testing Infrastructure

* **Unit/Integration Tests:** Cargo (Rust test framework)
* **E2E Tests:** Vitest v2.1.6 (TypeScript)
* **Coverage Tool:** Cargo-Tarpaulin v0.31.0 with LLVM
* **Current Threshold:** 90% (fail-under)

### Existing Test Coverage

* **12 integration test files** with 436+ test functions (6,420 lines)
* **273 inline unit tests** across 60 source files
* **8 E2E test files** (3,491 lines)

### Well-Tested Modules

* `issue/` - 68 inline tests + comprehensive integration tests
* `pr/` - 44 inline tests + integration tests
* `workspace/` - 30 inline tests
* `llm/` - 30 inline tests
* `sync/` - 30 inline tests
* `docs/` - 19 integration tests

## Coverage Gaps

### Modules with NO unit tests

1. **reconciliation/** (4 files) - Only has integration tests
1. **config/** (1 file) - No tests
1. **server/** (1 file) - No tests
1. **manifest/** (2 files) - No inline tests
1. **features/** (4 files) - Minimal tests (3 total)

### Modules with MINIMAL tests

* **docs/** - 7 inline tests (2 files)
* **template/** - 5 inline tests (3 files)
* **user/** - 3 inline tests (5 files)

### Modules lacking integration tests

* **search/** - 0 integration tests
* **migration/** - 0 integration tests
* **llm/** - 0 integration tests
* **sync/** - 0 integration tests
* **features/** - 0 integration tests

### Untested code paths

* Error handling across modules
* Git operation failure scenarios
* Conflict resolution edge cases
* Migration failure cases
* LLM agent error states
* Search query syntax error handling
* Workspace cleanup edge cases

## Implementation Plan

### Phase 1: Unit Tests for Untested Modules

* [ ] Add unit tests for `reconciliation/` module
* [ ] Add unit tests for `config/` module
* [ ] Add unit tests for `server/` module
* [ ] Add unit tests for `manifest/` module
* [ ] Expand `features/` module tests

### Phase 2: Expand Minimal Coverage

* [ ] Add more unit tests for `docs/` module
* [ ] Add more unit tests for `template/` module
* [ ] Add more unit tests for `user/` module

### Phase 3: Integration Tests

* [ ] Add integration tests for `search/` module
* [ ] Add integration tests for `migration/` module
* [ ] Add integration tests for `llm/` module
* [ ] Add integration tests for `sync/` module
* [ ] Add integration tests for `features/` module

### Phase 4: Error Path Testing

* [ ] Test error handling in git operations
* [ ] Test conflict resolution scenarios
* [ ] Test migration failure recovery
* [ ] Test LLM agent spawn failures
* [ ] Test search query parse errors
* [ ] Test workspace cleanup failures

### Phase 5: Update Configuration

* [ ] Update `.tarpaulin.toml` threshold from 90% to 100%
* [ ] Ensure CI pipeline enforces 100% coverage

## Success Criteria

* All modules have unit tests
* All public APIs have integration tests
* Error paths are tested
* Coverage reports show 100%
* CI enforces 100% threshold
